{"version":3,"file":"EvtOut.mjs","sources":["../../../../plugin/common/EvtOut.ts"],"sourcesContent":["/// <reference lib=\"dom\"/>\n\nexport class EvtOut<T> {\n  #controller!: ReadableStreamController<T>;\n  #stream = new ReadableStream<T>({\n    start: (controller) => (this.#controller = controller),\n  });\n  emit(data: T) {\n    this.#controller.enqueue(data);\n  }\n\n  async *#toAsyncGenerator(reader: ReadableStreamDefaultReader<T>) {\n    do {\n      const result = await reader.read();\n      if (result.done) {\n        break;\n      }\n      yield result.value!;\n    } while (true);\n  }\n  toAsyncGenerator(): Evt<T> {\n    const stream = this.#stream.tee()[1];\n    const reader = stream.getReader();\n    const ag = this.#toAsyncGenerator(reader);\n    const _return = ag.return;\n    ag.return = (value) => {\n      reader.cancel();\n      return _return.call(ag, value);\n    };\n\n    const _throw = ag.throw;\n    ag.throw = (e) => {\n      reader.cancel();\n      return _throw.call(ag, e);\n    };\n    return ag;\n  }\n}\nexport type Evt<T = unknown> = AsyncGenerator<\n  Awaited<NonNullable<T>>,\n  void,\n  void\n>;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAEO;AAAA,MAAM,OAAU;AAAA,EAAhB;AASE;AARP;AACA,gCAAU,IAAI,eAAkB;AAAA,MAC9B,OAAO,CAAC,eAAgB,mBAAmB,aAAA;AAAA,IAAA,CAC5C;AAAA;AAAA,EACD,KAAK,MAAS;AACZ,uBAAA,aAAiB,QAAQ,IAAI;AAAA,EAC/B;AAAA,EAWA,mBAA2B;AACnB,UAAA,SAAS,mBAAa,SAAA,IAAM,EAAA;AAC5B,UAAA,SAAS,OAAO;AAChB,UAAA,KAAK,8DAAA,WAAuB;AAClC,UAAM,UAAU,GAAG;AAChB,OAAA,SAAS,CAAC,UAAU;AACrB,aAAO,OAAO;AACP,aAAA,QAAQ,KAAK,IAAI,KAAK;AAAA,IAAA;AAG/B,UAAM,SAAS,GAAG;AACf,OAAA,QAAQ,CAAC,MAAM;AAChB,aAAO,OAAO;AACP,aAAA,OAAO,KAAK,IAAI,CAAC;AAAA,IAAA;AAEnB,WAAA;AAAA,EACT;AACF;AAlCE;AACA;AAOO;AAAA,uCAAkB,QAAwC;AAC5D,KAAA;AACK,UAAA,SAAS,MAAM,OAAO;AAC5B,QAAI,OAAO,MAAM;AACf;AAAA,IACF;AACA,UAAM,OAAO;AAAA,EACN,SAAA;AACX;;"}