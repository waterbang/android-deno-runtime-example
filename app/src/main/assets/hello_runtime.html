<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>测试</title>
</head>
<script src="./assets/js/msgpack.js" type="text/javascript"></script>
<script src="./assets/js/easy-rpc.js" type="text/javascript"></script>
<body>
<fieldset>
    <button onclick="callAndroid()" type="button">点击调用Android代码</button>
    <button onclick="onCallAndroid()" type="button">Android调用JS</button>
    <script>
         function callAndroid(){
            Android_nav.showToast("JS调用了android中的hello方法");
         }

         function onCallAndroid() {
            Android_nav.onBackPressed();
         }

         function onBackPressed(){
            let con = confirm( "Android调用JS，确定要关闭页面?" ); //在页面上弹出对话框
            console.log("Con ===============> ",con);
            if (con == true ) Android_nav.finishActivity();
            return "JS的返回值，Android可以接收到"
         }

    </script>
</fieldset>
<fieldset>
    <button onclick="onCallAndroid()" type="button">Android调用JS</button>
    <script>
   window.onload = async e => {
      const ECHO = 1
      const BIGDATA = 2
      try {
         let session = await new EasySession('ws://localhost:3333', {
            __onclose(e) {
                confirm("OnClose", e);
               console.log("OnClose", e)
            },
            [ECHO]: (arg) => {
               confirm("Client Received", arg);
               console.log("Client Received", arg)
               return arg + 1
            },
         })
         console.assert(2, await session.request(ECHO, 0))
      } catch (err) {
         alert(JSON.stringify(err))
      }
   }

    </script>
</fieldset>
</body>
</html>